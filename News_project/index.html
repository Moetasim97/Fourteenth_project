<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Template</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">


  <link rel="stylesheet" href="styles.css">

</head>

<body class="bg-white">
  

  <div class="d-flex justify-content-center "><div id="carouselExample" class="carousel slide">
    <div class="carousel-inner ">
      <div class="carousel-item active"  class="">
        
        <div class="description mx-0 px-0 mt-3" align="center"></div>
      </div>
      
      
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://raw.githubusercontent.com/janl/mustache.js/master/mustache.js"></script>
  <script>

    
   

var eventsMediator = {
  events: {},
  on: function (eventName, callbackfn) {
    this.events[eventName] = this.events[eventName]
      ? this.events[eventName]
      : [];
    this.events[eventName].push(callbackfn);
  },
  emit: function (eventName, data) {
    if (this.events[eventName]) {
      this.events[eventName].forEach(function (callBackfn) {
        callBackfn(data);
      });
    }
  },
};

//mediator pattern ########################################################################################




    var model=[{}]
    var array=[]
    
    
    

   
    



var controller={
  key:"value",
  init:function(){
    $.ajax({
   type:'GET',
  url: 'https://restcountries.com/v3.1/all',
  error:function(xhr){
    console.log(xhr)
  },
  success: function (result, status,xhr) {
    for(var i=0;i<10;i++){
      var flag=result[i].flags.png
      var name=result[i].altSpellings[0]
      model[i]={flag}
      model[i].country_code=name
    }
    for(var u=0;u<10;u++){
 array.push(model[u].country_code.toLowerCase())
}
// event mediator instance to pass the model after it was mounted with the data to the second api call where the articles are going to be retrieved
eventsMediator.emit("model initialized",model)
  }
});
// second api call #############################################################################
      },
  render_articles:function(){
    $.ajax({
   type:'GET',
  url:'https://newsapi.org/v2/top-headlines/sources?category=business',
  headers:{"x-api-key":'9322bc00166d486bb1dbda137b97f522'},
  
  error:function(xhr){
    console.log(xhr)
  },
  success: function (result, status,xhr) {

    eventsMediator.on("model initialized",function(model){
      return model
    })

    
    
    for(let i=0;i<model.length;i++){
      
      model[i].country_article=result.sources[i].description
    }
    if(model[0].country_article!=undefined){
     for(var i=0;model.length;i++){
      document.querySelectorAll(".description")[i].textContent=model[i].country_article
     }
    }
    
  
    
// model finished initializing and now the mvc framework will begin in the application
  }
}
)
  }
}




      var view={
  init:function(){
    return controller.init()
  },
  render_main_carousel:function(){
   
     $("document").ready(function(){
      
      $(".carousel-item.active").prepend(`<img src=${model[0].flag} class="d-block">`)
     })

    
     
    
  },

  render_slides:function(){

        $("document").ready(function(){
          
      for(var i=1;i<model.length;i++){
       
      document.querySelector(".carousel-inner").innerHTML+=`<div class="carousel-item w-100" align="center">
        <img src=${model[i].flag} class="d-block   " alt="...">
        <div class="description">`+model[i].country_article+`</div>
      </div>`
      
    }
    })

  }

  
}

view.init()


view.render_main_carousel()

view.render_slides()
controller.render_articles()


eventsMediator.on("random",function(x){console.log(x+"hi")})








      



   


   
   
  </script>
</body>
</html>